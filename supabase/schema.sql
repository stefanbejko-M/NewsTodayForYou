create table if not exists public.category(id serial primary key,slug text unique not null,name text not null);create table if not exists public.author(id serial primary key,name text not null,bio text,is_system boolean default false);create table if not exists public.post(id bigserial primary key,title text not null,slug text unique not null,excerpt text,body text not null,category_id int references public.category(id) on delete set null,source_url text,source_name text,created_at timestamptz default now(),updated_at timestamptz default now(),author_id int references public.author(id),is_published boolean default true);insert into public.author(name,is_system) select 'Izabela',true where not exists(select 1 from public.author where name='Izabela');insert into public.category(slug,name) select * from (values('celebrity','Celebrity'),('politics','Politics'),('ai-news','AI News'),('daily-highlights','Daily Highlights')) v(slug,name) where not exists(select 1 from public.category where category.slug=v.slug);alter table public.post add column if not exists tsv tsvector;create index if not exists post_tsv_idx on public.post using gin(tsv);create or replace function public.post_tsv_trigger() returns trigger as $$ begin new.tsv := to_tsvector('simple', coalesce(new.title,'') || ' ' || coalesce(new.excerpt,'') || ' ' || coalesce(new.body,'')); return new; end $$ language plpgsql;drop trigger if exists post_tsv on public.post;create trigger post_tsv before insert or update on public.post for each row execute function public.post_tsv_trigger();
